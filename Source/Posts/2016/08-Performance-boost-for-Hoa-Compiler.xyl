<?xml version="1.0" encoding="utf-8"?>
<?xyl-overlay href="hoa://Application/Overlays/Article.xyl"?>
<?xyl-meta name="title" value="Performance boost for Hoa\Compiler"?>
<?xyl-meta name="date" value="2016-08-22T08:17:28+02:00"?>

<overlay xmlns="http://hoa-project.net/xyl/xylophone">
  <article id="main">
    <p>
      A lot of work has been done <strong>to boost the performance</strong> of
      <a href="http://central.hoa-project.net/Resource/Library/Compiler"><code>Hoa\Compiler</code></a>,
      mainly by reducing the amount of memory required to lexically or to
      syntactically analyse it. With a large data, <strong>up to 80% of the
       memory can be saved</strong>.
    </p>

    <h2>Constant memory usage in the lexer</h2>

    <p>
      First of all, one of the biggest improvement lands in the lexer (aka the
      lexical analyser). The lexer is responsible of cutting a datum into a
      sequence of tokens (aka lexemes). So it reads the entire datum and
      produces an entire sequence.
      (<a href="http://hoa-project.net/Literature/Hack/Compiler.html">Learn more
      by reading its documentation</a>). Until today.
    </p>
    <p>
      The issue with this approach is that if the datum is of length 1Mb, then
      the memory will contain 1Mb (the original datum) and at least 1Mb (the
      sequence). However, the sequence is represented as a PHP array, so it has
      an overhead of some bytes per tokens, in addition to the meta data attached
      to the token (like the name, the namespace, the length, the offset etc.).
      The resulting overhead size will depend of the PHP version in use but this
      is not good.
    </p>
    <p>
      Thus, a straightforward optimisation consists at transforming the lexer into
      an iterator. Actually, it has been <strong>transformed into a
      generator</strong>. So each call to the lexer will produce the next
      token, without stacking all the tokens in memory.
    </p>
    <p>
      With this new approach, the API stays <strong>identically the
      same</strong> and the memory peak usage is <strong>drastically
      reduced</strong>.
    </p>
    <figure>
      <img
        src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB3aWR0aD0iMTYwbW0iIGhlaWdodD0iOTBtbSIgdmlld0JveD0iMCAwIDE2MDAwIDkwMDAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBzdHJva2Utd2lkdGg9IjI4LjIyMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gODI1OSw3MjE2IEwgMzE2Nyw3MjE2IDMxNjcsMzgzIDEzMzUxLDM4MyAxMzM1MSw3MjE2IDgyNTksNzIxNiBaIi8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gMTMzNTEsNzIxNSBMIDMxNjcsNzIxNSIvPgogPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2IoMTc5LDE3OSwxNzkpIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNIDEzMzUxLDYyMzggTCAzMTY3LDYyMzgiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAxMzM1MSw1MjYyIEwgMzE2Nyw1MjYyIi8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gMTMzNTEsNDI4NyBMIDMxNjcsNDI4NyIvPgogPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2IoMTc5LDE3OSwxNzkpIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNIDEzMzUxLDMzMTAgTCAzMTY3LDMzMTAiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAxMzM1MSwyMzM0IEwgMzE2NywyMzM0Ii8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gMTMzNTEsMTM1OCBMIDMxNjcsMTM1OCIvPgogPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2IoMTc5LDE3OSwxNzkpIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNIDEzMzUxLDM4MiBMIDMxNjcsMzgyIi8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gMzE2Nyw3MzY1IEwgMzE2Nyw3MjE1Ii8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gMzE2Nyw3MzY1IEwgMzE2Nyw3MjE1Ii8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gNjU2Miw3MzY1IEwgNjU2Miw3MjE1Ii8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gNjU2Miw3MzY1IEwgNjU2Miw3MjE1Ii8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gOTk1Niw3MzY1IEwgOTk1Niw3MjE1Ii8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gOTk1Niw3MzY1IEwgOTk1Niw3MjE1Ii8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gMTMzNTEsNzM2NSBMIDEzMzUxLDcyMTUiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAxMzM1MSw3MzY1IEwgMTMzNTEsNzIxNSIvPgogPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2IoMTc5LDE3OSwxNzkpIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNIDMxNjcsNzIxNSBMIDEzMzUxLDcyMTUiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAzMDE3LDcyMTUgTCAzMTY3LDcyMTUiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAzMDE3LDcyMTUgTCAzMTY3LDcyMTUiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAzMDE3LDYyMzggTCAzMTY3LDYyMzgiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAzMDE3LDYyMzggTCAzMTY3LDYyMzgiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAzMDE3LDUyNjIgTCAzMTY3LDUyNjIiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAzMDE3LDUyNjIgTCAzMTY3LDUyNjIiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAzMDE3LDQyODcgTCAzMTY3LDQyODciLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAzMDE3LDQyODcgTCAzMTY3LDQyODciLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAzMDE3LDMzMTAgTCAzMTY3LDMzMTAiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAzMDE3LDMzMTAgTCAzMTY3LDMzMTAiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAzMDE3LDIzMzQgTCAzMTY3LDIzMzQiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAzMDE3LDIzMzQgTCAzMTY3LDIzMzQiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAzMDE3LDEzNTggTCAzMTY3LDEzNTgiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAzMDE3LDEzNTggTCAzMTY3LDEzNTgiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAzMDE3LDM4MiBMIDMxNjcsMzgyIi8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gMzAxNywzODIgTCAzMTY3LDM4MiIvPgogPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2IoMTc5LDE3OSwxNzkpIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNIDMxNjcsNzIxNSBMIDMxNjcsMzgyIi8+CiA8cGF0aCBmaWxsPSJyZ2IoMCw2OSwxMzQpIiBzdHJva2U9Im5vbmUiIGQ9Ik0gMTA1MjEsNzIxNSBMIDExNjUzLDcyMTUgMTE2NTMsMTIzNiAxMDUyMSwxMjM2IDEwNTIxLDcyMTUgWiIvPgogPHBhdGggZmlsbD0icmdiKDAsNjksMTM0KSIgc3Ryb2tlPSJub25lIiBkPSJNIDcxMjcsNzIxNSBMIDgyNTgsNzIxNSA4MjU4LDYxMTIgNzEyNyw2MTEyIDcxMjcsNzIxNSBaIi8+CiA8cGF0aCBmaWxsPSJyZ2IoMCw2OSwxMzQpIiBzdHJva2U9Im5vbmUiIGQ9Ik0gMzczMiw3MjE1IEwgNDg2NCw3MjE1IDQ4NjQsNjE1NiAzNzMyLDYxNTYgMzczMiw3MjE1IFoiLz4KIDxwYXRoIGZpbGw9InJnYigyNTUsNjYsMTQpIiBzdHJva2U9Im5vbmUiIGQ9Ik0gMTE2NTMsNzIxNSBMIDEyNzg1LDcyMTUgMTI3ODUsNjAyOCAxMTY1Myw2MDI4IDExNjUzLDcyMTUgWiIvPgogPHBhdGggZmlsbD0icmdiKDI1NSw2NiwxNCkiIHN0cm9rZT0ibm9uZSIgZD0iTSA4MjU4LDcyMTUgTCA5MzkwLDcyMTUgOTM5MCw2MTU0IDgyNTgsNjE1NCA4MjU4LDcyMTUgWiIvPgogPHBhdGggZmlsbD0icmdiKDI1NSw2NiwxNCkiIHN0cm9rZT0ibm9uZSIgZD0iTSA0ODY0LDcyMTUgTCA1OTk2LDcyMTUgNTk5Niw2MTU2IDQ4NjQsNjE1NiA0ODY0LDcyMTUgWiIvPgogPHRleHQgY2xhc3M9IlRleHRTaGFwZSI+PHRzcGFuIGNsYXNzPSJUZXh0UGFyYWdyYXBoIiBmb250LWZhbWlseT0iTXVzZW8iIGZvbnQtc2l6ZT0iMzUzcHgiIGZvbnQtd2VpZ2h0PSIzMDAiPjx0c3BhbiBjbGFzcz0iVGV4dFBvc2l0aW9uIiB4PSI0Njg0IiB5PSI3NzgwIj48dHNwYW4gZmlsbD0icmdiKDAsMCwwKSIgc3Ryb2tlPSJub25lIj4xODwvdHNwYW4+PC90c3Bhbj48L3RzcGFuPjwvdGV4dD4KIDx0ZXh0IGNsYXNzPSJUZXh0U2hhcGUiPjx0c3BhbiBjbGFzcz0iVGV4dFBhcmFncmFwaCIgZm9udC1mYW1pbHk9Ik11c2VvIiBmb250LXNpemU9IjM1M3B4IiBmb250LXdlaWdodD0iMzAwIj48dHNwYW4gY2xhc3M9IlRleHRQb3NpdGlvbiIgeD0iNzg4OCIgeT0iNzc4MCI+PHRzcGFuIGZpbGw9InJnYigwLDAsMCkiIHN0cm9rZT0ibm9uZSI+MTA5MTwvdHNwYW4+PC90c3Bhbj48L3RzcGFuPjwvdGV4dD4KIDx0ZXh0IGNsYXNzPSJUZXh0U2hhcGUiPjx0c3BhbiBjbGFzcz0iVGV4dFBhcmFncmFwaCIgZm9udC1mYW1pbHk9Ik11c2VvIiBmb250LXNpemU9IjM1M3B4IiBmb250LXdlaWdodD0iMzAwIj48dHNwYW4gY2xhc3M9IlRleHRQb3NpdGlvbiIgeD0iMTExNzAiIHk9Ijc3ODAiPjx0c3BhbiBmaWxsPSJyZ2IoMCwwLDApIiBzdHJva2U9Im5vbmUiPjY1NDMyPC90c3Bhbj48L3RzcGFuPjwvdHNwYW4+PC90ZXh0PgogPHRleHQgY2xhc3M9IlRleHRTaGFwZSI+PHRzcGFuIGNsYXNzPSJUZXh0UGFyYWdyYXBoIiBmb250LWZhbWlseT0iTXVzZW8iIGZvbnQtc2l6ZT0iMzUzcHgiIGZvbnQtd2VpZ2h0PSIzMDAiPjx0c3BhbiBjbGFzcz0iVGV4dFBvc2l0aW9uIiB4PSIyNzE1IiB5PSI3MzI5Ij48dHNwYW4gZmlsbD0icmdiKDAsMCwwKSIgc3Ryb2tlPSJub25lIj4wPC90c3Bhbj48L3RzcGFuPjwvdHNwYW4+PC90ZXh0PgogPHRleHQgY2xhc3M9IlRleHRTaGFwZSI+PHRzcGFuIGNsYXNzPSJUZXh0UGFyYWdyYXBoIiBmb250LWZhbWlseT0iTXVzZW8iIGZvbnQtc2l6ZT0iMzUzcHgiIGZvbnQtd2VpZ2h0PSIzMDAiPjx0c3BhbiBjbGFzcz0iVGV4dFBvc2l0aW9uIiB4PSIxNTkxIiB5PSI2MzUyIj48dHNwYW4gZmlsbD0icmdiKDAsMCwwKSIgc3Ryb2tlPSJub25lIj41MDAsMDAwPC90c3Bhbj48L3RzcGFuPjwvdHNwYW4+PC90ZXh0PgogPHRleHQgY2xhc3M9IlRleHRTaGFwZSI+PHRzcGFuIGNsYXNzPSJUZXh0UGFyYWdyYXBoIiBmb250LWZhbWlseT0iTXVzZW8iIGZvbnQtc2l6ZT0iMzUzcHgiIGZvbnQtd2VpZ2h0PSIzMDAiPjx0c3BhbiBjbGFzcz0iVGV4dFBvc2l0aW9uIiB4PSIxMzQ0IiB5PSI1Mzc2Ij48dHNwYW4gZmlsbD0icmdiKDAsMCwwKSIgc3Ryb2tlPSJub25lIj4xLDAwMCwwMDA8L3RzcGFuPjwvdHNwYW4+PC90c3Bhbj48L3RleHQ+CiA8dGV4dCBjbGFzcz0iVGV4dFNoYXBlIj48dHNwYW4gY2xhc3M9IlRleHRQYXJhZ3JhcGgiIGZvbnQtZmFtaWx5PSJNdXNlbyIgZm9udC1zaXplPSIzNTNweCIgZm9udC13ZWlnaHQ9IjMwMCI+PHRzcGFuIGNsYXNzPSJUZXh0UG9zaXRpb24iIHg9IjEzNDQiIHk9IjQ0MDAiPjx0c3BhbiBmaWxsPSJyZ2IoMCwwLDApIiBzdHJva2U9Im5vbmUiPjEsNTAwLDAwMDwvdHNwYW4+PC90c3Bhbj48L3RzcGFuPjwvdGV4dD4KIDx0ZXh0IGNsYXNzPSJUZXh0U2hhcGUiPjx0c3BhbiBjbGFzcz0iVGV4dFBhcmFncmFwaCIgZm9udC1mYW1pbHk9Ik11c2VvIiBmb250LXNpemU9IjM1M3B4IiBmb250LXdlaWdodD0iMzAwIj48dHNwYW4gY2xhc3M9IlRleHRQb3NpdGlvbiIgeD0iMTI5OSIgeT0iMzQyMyI+PHRzcGFuIGZpbGw9InJnYigwLDAsMCkiIHN0cm9rZT0ibm9uZSI+MiwwMDAsMDAwPC90c3Bhbj48L3RzcGFuPjwvdHNwYW4+PC90ZXh0PgogPHRleHQgY2xhc3M9IlRleHRTaGFwZSI+PHRzcGFuIGNsYXNzPSJUZXh0UGFyYWdyYXBoIiBmb250LWZhbWlseT0iTXVzZW8iIGZvbnQtc2l6ZT0iMzUzcHgiIGZvbnQtd2VpZ2h0PSIzMDAiPjx0c3BhbiBjbGFzcz0iVGV4dFBvc2l0aW9uIiB4PSIxMzIxIiB5PSIyNDQ3Ij48dHNwYW4gZmlsbD0icmdiKDAsMCwwKSIgc3Ryb2tlPSJub25lIj4yLDUwMCwwMDA8L3RzcGFuPjwvdHNwYW4+PC90c3Bhbj48L3RleHQ+CiA8dGV4dCBjbGFzcz0iVGV4dFNoYXBlIj48dHNwYW4gY2xhc3M9IlRleHRQYXJhZ3JhcGgiIGZvbnQtZmFtaWx5PSJNdXNlbyIgZm9udC1zaXplPSIzNTNweCIgZm9udC13ZWlnaHQ9IjMwMCI+PHRzcGFuIGNsYXNzPSJUZXh0UG9zaXRpb24iIHg9IjEzMjEiIHk9IjE0NzEiPjx0c3BhbiBmaWxsPSJyZ2IoMCwwLDApIiBzdHJva2U9Im5vbmUiPjMsMDAwLDAwMDwvdHNwYW4+PC90c3Bhbj48L3RzcGFuPjwvdGV4dD4KIDx0ZXh0IGNsYXNzPSJUZXh0U2hhcGUiPjx0c3BhbiBjbGFzcz0iVGV4dFBhcmFncmFwaCIgZm9udC1mYW1pbHk9Ik11c2VvIiBmb250LXNpemU9IjM1M3B4IiBmb250LXdlaWdodD0iMzAwIj48dHNwYW4gY2xhc3M9IlRleHRQb3NpdGlvbiIgeD0iMTMyMSIgeT0iNDk1Ij48dHNwYW4gZmlsbD0icmdiKDAsMCwwKSIgc3Ryb2tlPSJub25lIj4zLDUwMCwwMDA8L3RzcGFuPjwvdHNwYW4+PC90c3Bhbj48L3RleHQ+CiA8cGF0aCBmaWxsPSJyZ2IoMCw2OSwxMzQpIiBzdHJva2U9Im5vbmUiIGQ9Ik0gMTM4OTMsNDM1MiBMIDEzNzg3LDQzNTIgMTM3ODcsNDE0MSAxMzk5OCw0MTQxIDEzOTk4LDQzNTIgMTM4OTMsNDM1MiBaIi8+CiA8cGF0aCBmaWxsPSJyZ2IoMjU1LDY2LDE0KSIgc3Ryb2tlPSJub25lIiBkPSJNIDEzODkzLDQ4NTcgTCAxMzc4Nyw0ODU3IDEzNzg3LDQ2NDYgMTM5OTgsNDY0NiAxMzk5OCw0ODU3IDEzODkzLDQ4NTcgWiIvPgogPHRleHQgY2xhc3M9IlRleHRTaGFwZSI+PHRzcGFuIGNsYXNzPSJUZXh0UGFyYWdyYXBoIiBmb250LWZhbWlseT0iTXVzZW8iIGZvbnQtc2l6ZT0iMzUzcHgiIGZvbnQtd2VpZ2h0PSIzMDAiPjx0c3BhbiBjbGFzcz0iVGV4dFBvc2l0aW9uIiB4PSIxNDA5OCIgeT0iNDM1OSI+PHRzcGFuIGZpbGw9InJnYigwLDAsMCkiIHN0cm9rZT0ibm9uZSI+Y29sbGVjdGlvbjwvdHNwYW4+PC90c3Bhbj48L3RzcGFuPjwvdGV4dD4KIDx0ZXh0IGNsYXNzPSJUZXh0U2hhcGUiPjx0c3BhbiBjbGFzcz0iVGV4dFBhcmFncmFwaCIgZm9udC1mYW1pbHk9Ik11c2VvIiBmb250LXNpemU9IjM1M3B4IiBmb250LXdlaWdodD0iMzAwIj48dHNwYW4gY2xhc3M9IlRleHRQb3NpdGlvbiIgeD0iMTQwOTgiIHk9IjQ4NjQiPjx0c3BhbiBmaWxsPSJyZ2IoMCwwLDApIiBzdHJva2U9Im5vbmUiPmdlbmVyYXRvcjwvdHNwYW4+PC90c3Bhbj48L3RzcGFuPjwvdGV4dD4KIDx0ZXh0IGNsYXNzPSJUZXh0U2hhcGUiPjx0c3BhbiBjbGFzcz0iVGV4dFBhcmFncmFwaCIgZm9udC1mYW1pbHk9Ik11c2VvIiBmb250LXNpemU9IjMxOHB4IiBmb250LXdlaWdodD0iMzAwIj48dHNwYW4gY2xhc3M9IlRleHRQb3NpdGlvbiIgeD0iNTM0NyIgeT0iODQxOCI+PHRzcGFuIGZpbGw9InJnYigwLDAsMCkiIHN0cm9rZT0ibm9uZSI+U2l6ZSBvZiB0aGUgZGF0dW0gKGluIGJ5dGVzKTwvdHNwYW4+PC90c3Bhbj48L3RzcGFuPjwvdGV4dD4KIDx0ZXh0IGNsYXNzPSJUZXh0U2hhcGUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDgxNiw2MTk0KSByb3RhdGUoLTkwKSB0cmFuc2xhdGUoLTgxNiwtNjE5NCkiPjx0c3BhbiBjbGFzcz0iVGV4dFBhcmFncmFwaCIgZm9udC1mYW1pbHk9Ik11c2VvIiBmb250LXNpemU9IjMxOHB4IiBmb250LXdlaWdodD0iMzAwIj48dHNwYW4gY2xhc3M9IlRleHRQb3NpdGlvbiIgeD0iODE2IiB5PSI2MTk0Ij48dHNwYW4gZmlsbD0icmdiKDAsMCwwKSIgc3Ryb2tlPSJub25lIj5NZW1vcnkgcGVhayB1c2FnZSAoaW4gYnl0ZXMpPC90c3Bhbj48L3RzcGFuPjwvdHNwYW4+PC90ZXh0Pgo8L3N2Zz4="
        style="max-width: 600px; width: 100%" />
      <figcaption>
        This graph presents 3 data of different size: small (18 bytes), medium
        (1091 bytes) and large (65432 bytes). These data are JSON strings. For
        each data, the memory peak usages have been analysed with the two
        approaches: Collection (before) and generator (after). The memory is
        almost constant, and the more the lexer has to consume, the greater the
        delta is.
      </figcaption>
    </figure>

    <h2>Save memory and CPU in the parser, and pragmas</h2>

    <p>
      Now, the parser takes the benefits from the lexer since it is an iterator.
      Method calls have been reduced, so many CPU cycles have been saved. Also,
      <strong>indirections have been reduced</strong>. When a datum points to
      another datum that points to the final one, we count 2 indirections to get
      the final datum. A redirection has a cost. This cost has been reduced.
    </p>
    <p>
      Also, the lexer is wrapped inside a <code>Hoa\Iterator\Buffer</code>
      iterator. This brings a new feature. One may remember that the parser is
      called <code>Hoa\Compiler\Llk\Parser</code>, so it is LL(<em>k</em>). But
      it was LL(<em>*</em>). Now this is a real LL(<em>k</em>) and we can set
      the value of <em>k</em>, thanks to the new feature introduced in the
      grammar description language: <strong>Pragmas</strong>. Indeed, by writing:
    </p>
    <pre><code>%pragma parser.lookahead 0</code></pre>
    <p>
      we obtain a LL(0) parser, for free. If the parser needs to go beyond the
      value of <em>k</em>, an exception will be thrown.
    </p>
    <p>
      And with a buffer iterator wrapping the lexer, this is still possible to
      move foreward and backward in the lexer without reading lexing tokens
      several times.
    </p>

    <h2>Exporting the parser into PHP code</h2>

    <p>
      <code>Hoa\Compiler\Llk</code> is a compiler-compiler. What it means is
      that given a grammar, it is compiled into a parser, and then the parser
      is used to get a compiler. This first compilation, grammar to in-memory
      parser, is not useful everytime. Actually, it must be done once before
      going to production.
    </p>
    <p>
      So far, the solution was to serialise the in-memory parser and save it
      into a file. Serialisation is dangerous from a security point of view. The
      source must be trusted. This was not a comfortable situation for our
      users.
    </p>
    <p>
      Now, this is possible to <strong>save the in-memory parser to a string
      representing PHP code</strong>. This PHP code instanciates the same
      parser (at its initial state). The parser takes the form of a PHP class.
      Thus, one might write this PHP code into a file, commit this file and use
      it as any regular PHP classes, with autoloaders and so on.
    </p>
    <figure>
      <img
        src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB3aWR0aD0iMTYwbW0iIGhlaWdodD0iOTBtbSIgdmlld0JveD0iMCAwIDE2MDAwIDkwMDAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBzdHJva2Utd2lkdGg9IjI4LjIyMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gODE5NCw3MjAyIEwgMzEyMSw3MjAyIDMxMjEsMzgzIDEzMjY3LDM4MyAxMzI2Nyw3MjAyIDgxOTQsNzIwMiBaIi8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gMTMyNjcsNzIwMSBMIDMxMjEsNzIwMSIvPgogPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2IoMTc5LDE3OSwxNzkpIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNIDEzMjY3LDYyMjYgTCAzMTIxLDYyMjYiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAxMzI2Nyw1MjUyIEwgMzEyMSw1MjUyIi8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gMTMyNjcsNDI3OSBMIDMxMjEsNDI3OSIvPgogPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2IoMTc5LDE3OSwxNzkpIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNIDEzMjY3LDMzMDQgTCAzMTIxLDMzMDQiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAxMzI2NywyMzMwIEwgMzEyMSwyMzMwIi8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gMTMyNjcsMTM1NiBMIDMxMjEsMTM1NiIvPgogPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2IoMTc5LDE3OSwxNzkpIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNIDEzMjY3LDM4MiBMIDMxMjEsMzgyIi8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gMzEyMSw3MzUxIEwgMzEyMSw3MjAxIi8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gMzEyMSw3MzUxIEwgMzEyMSw3MjAxIi8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gNjUwMyw3MzUxIEwgNjUwMyw3MjAxIi8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gNjUwMyw3MzUxIEwgNjUwMyw3MjAxIi8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gOTg4NCw3MzUxIEwgOTg4NCw3MjAxIi8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gOTg4NCw3MzUxIEwgOTg4NCw3MjAxIi8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gMTMyNjcsNzM1MSBMIDEzMjY3LDcyMDEiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAxMzI2Nyw3MzUxIEwgMTMyNjcsNzIwMSIvPgogPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2IoMTc5LDE3OSwxNzkpIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNIDMxMjEsNzIwMSBMIDEzMjY3LDcyMDEiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAyOTcxLDcyMDEgTCAzMTIxLDcyMDEiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAyOTcxLDcyMDEgTCAzMTIxLDcyMDEiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAyOTcxLDYyMjYgTCAzMTIxLDYyMjYiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAyOTcxLDYyMjYgTCAzMTIxLDYyMjYiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAyOTcxLDUyNTIgTCAzMTIxLDUyNTIiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAyOTcxLDUyNTIgTCAzMTIxLDUyNTIiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAyOTcxLDQyNzkgTCAzMTIxLDQyNzkiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAyOTcxLDQyNzkgTCAzMTIxLDQyNzkiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAyOTcxLDMzMDQgTCAzMTIxLDMzMDQiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAyOTcxLDMzMDQgTCAzMTIxLDMzMDQiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAyOTcxLDIzMzAgTCAzMTIxLDIzMzAiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAyOTcxLDIzMzAgTCAzMTIxLDIzMzAiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAyOTcxLDEzNTYgTCAzMTIxLDEzNTYiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAyOTcxLDEzNTYgTCAzMTIxLDEzNTYiLz4KIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDE3OSwxNzksMTc5KSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTSAyOTcxLDM4MiBMIDMxMjEsMzgyIi8+CiA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9InJnYigxNzksMTc5LDE3OSkiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0gMjk3MSwzODIgTCAzMTIxLDM4MiIvPgogPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2IoMTc5LDE3OSwxNzkpIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNIDMxMjEsNzIwMSBMIDMxMjEsMzgyIi8+CiA8cGF0aCBmaWxsPSJyZ2IoMCw2OSwxMzQpIiBzdHJva2U9Im5vbmUiIGQ9Ik0gMTA0NDgsNzIwMSBMIDExNTc1LDcyMDEgMTE1NzUsMTIxNiAxMDQ0OCwxMjE2IDEwNDQ4LDcyMDEgWiIvPgogPHBhdGggZmlsbD0icmdiKDAsNjksMTM0KSIgc3Ryb2tlPSJub25lIiBkPSJNIDcwNjcsNzIwMSBMIDgxOTMsNzIwMSA4MTkzLDEyODMgNzA2NywxMjgzIDcwNjcsNzIwMSBaIi8+CiA8cGF0aCBmaWxsPSJyZ2IoMCw2OSwxMzQpIiBzdHJva2U9Im5vbmUiIGQ9Ik0gMzY4NCw3MjAxIEwgNDgxMiw3MjAxIDQ4MTIsMTMzMSAzNjg0LDEzMzEgMzY4NCw3MjAxIFoiLz4KIDxwYXRoIGZpbGw9InJnYigyNTUsNjYsMTQpIiBzdHJva2U9Im5vbmUiIGQ9Ik0gMTE1NzUsNzIwMSBMIDEyNzAzLDcyMDEgMTI3MDMsMzc2MyAxMTU3NSwzNzYzIDExNTc1LDcyMDEgWiIvPgogPHBhdGggZmlsbD0icmdiKDI1NSw2NiwxNCkiIHN0cm9rZT0ibm9uZSIgZD0iTSA4MTkzLDcyMDEgTCA5MzIwLDcyMDEgOTMyMCwzODEzIDgxOTMsMzgxMyA4MTkzLDcyMDEgWiIvPgogPHBhdGggZmlsbD0icmdiKDI1NSw2NiwxNCkiIHN0cm9rZT0ibm9uZSIgZD0iTSA0ODEyLDcyMDEgTCA1OTM5LDcyMDEgNTkzOSwzODc0IDQ4MTIsMzg3NCA0ODEyLDcyMDEgWiIvPgogPHRleHQgY2xhc3M9IlRleHRTaGFwZSI+PHRzcGFuIGNsYXNzPSJUZXh0UGFyYWdyYXBoIiBmb250LWZhbWlseT0iTXVzZW8iIGZvbnQtc2l6ZT0iMzUzcHgiIGZvbnQtd2VpZ2h0PSIzMDAiPjx0c3BhbiBjbGFzcz0iVGV4dFBvc2l0aW9uIiB4PSI0MzY2IiB5PSI3Nzc1Ij48dHNwYW4gZmlsbD0icmdiKDAsMCwwKSIgc3Ryb2tlPSJub25lIj5KU09OPC90c3Bhbj48L3RzcGFuPjwvdHNwYW4+PC90ZXh0PgogPHRleHQgY2xhc3M9IlRleHRTaGFwZSI+PHRzcGFuIGNsYXNzPSJUZXh0UGFyYWdyYXBoIiBmb250LWZhbWlseT0iTXVzZW8iIGZvbnQtc2l6ZT0iMzUzcHgiIGZvbnQtd2VpZ2h0PSIzMDAiPjx0c3BhbiBjbGFzcz0iVGV4dFBvc2l0aW9uIiB4PSI3Nzg4IiB5PSI3Nzc1Ij48dHNwYW4gZmlsbD0icmdiKDAsMCwwKSIgc3Ryb2tlPSJub25lIj5NYXRoPC90c3Bhbj48L3RzcGFuPjwvdHNwYW4+PC90ZXh0PgogPHRleHQgY2xhc3M9IlRleHRTaGFwZSI+PHRzcGFuIGNsYXNzPSJUZXh0UGFyYWdyYXBoIiBmb250LWZhbWlseT0iTXVzZW8iIGZvbnQtc2l6ZT0iMzUzcHgiIGZvbnQtd2VpZ2h0PSIzMDAiPjx0c3BhbiBjbGFzcz0iVGV4dFBvc2l0aW9uIiB4PSIxMTE3MCIgeT0iNzc3NSI+PHRzcGFuIGZpbGw9InJnYigwLDAsMCkiIHN0cm9rZT0ibm9uZSI+UnVsZXI8L3RzcGFuPjwvdHNwYW4+PC90c3Bhbj48L3RleHQ+CiA8dGV4dCBjbGFzcz0iVGV4dFNoYXBlIj48dHNwYW4gY2xhc3M9IlRleHRQYXJhZ3JhcGgiIGZvbnQtZmFtaWx5PSJNdXNlbyIgZm9udC1zaXplPSIzNTNweCIgZm9udC13ZWlnaHQ9IjMwMCI+PHRzcGFuIGNsYXNzPSJUZXh0UG9zaXRpb24iIHg9IjI2ODIiIHk9IjczMjQiPjx0c3BhbiBmaWxsPSJyZ2IoMCwwLDApIiBzdHJva2U9Im5vbmUiPjA8L3RzcGFuPjwvdHNwYW4+PC90c3Bhbj48L3RleHQ+CiA8dGV4dCBjbGFzcz0iVGV4dFNoYXBlIj48dHNwYW4gY2xhc3M9IlRleHRQYXJhZ3JhcGgiIGZvbnQtZmFtaWx5PSJNdXNlbyIgZm9udC1zaXplPSIzNTNweCIgZm9udC13ZWlnaHQ9IjMwMCI+PHRzcGFuIGNsYXNzPSJUZXh0UG9zaXRpb24iIHg9IjE1NDciIHk9IjYzNDkiPjx0c3BhbiBmaWxsPSJyZ2IoMCwwLDApIiBzdHJva2U9Im5vbmUiPjIwMCwwMDA8L3RzcGFuPjwvdHNwYW4+PC90c3Bhbj48L3RleHQ+CiA8dGV4dCBjbGFzcz0iVGV4dFNoYXBlIj48dHNwYW4gY2xhc3M9IlRleHRQYXJhZ3JhcGgiIGZvbnQtZmFtaWx5PSJNdXNlbyIgZm9udC1zaXplPSIzNTNweCIgZm9udC13ZWlnaHQ9IjMwMCI+PHRzcGFuIGNsYXNzPSJUZXh0UG9zaXRpb24iIHg9IjE1NDciIHk9IjUzNzUiPjx0c3BhbiBmaWxsPSJyZ2IoMCwwLDApIiBzdHJva2U9Im5vbmUiPjQwMCwwMDA8L3RzcGFuPjwvdHNwYW4+PC90c3Bhbj48L3RleHQ+CiA8dGV4dCBjbGFzcz0iVGV4dFNoYXBlIj48dHNwYW4gY2xhc3M9IlRleHRQYXJhZ3JhcGgiIGZvbnQtZmFtaWx5PSJNdXNlbyIgZm9udC1zaXplPSIzNTNweCIgZm9udC13ZWlnaHQ9IjMwMCI+PHRzcGFuIGNsYXNzPSJUZXh0UG9zaXRpb24iIHg9IjE1NDciIHk9IjQ0MDEiPjx0c3BhbiBmaWxsPSJyZ2IoMCwwLDApIiBzdHJva2U9Im5vbmUiPjYwMCwwMDA8L3RzcGFuPjwvdHNwYW4+PC90c3Bhbj48L3RleHQ+CiA8dGV4dCBjbGFzcz0iVGV4dFNoYXBlIj48dHNwYW4gY2xhc3M9IlRleHRQYXJhZ3JhcGgiIGZvbnQtZmFtaWx5PSJNdXNlbyIgZm9udC1zaXplPSIzNTNweCIgZm9udC13ZWlnaHQ9IjMwMCI+PHRzcGFuIGNsYXNzPSJUZXh0UG9zaXRpb24iIHg9IjE1NDciIHk9IjM0MjYiPjx0c3BhbiBmaWxsPSJyZ2IoMCwwLDApIiBzdHJva2U9Im5vbmUiPjgwMCwwMDA8L3RzcGFuPjwvdHNwYW4+PC90c3Bhbj48L3RleHQ+CiA8dGV4dCBjbGFzcz0iVGV4dFNoYXBlIj48dHNwYW4gY2xhc3M9IlRleHRQYXJhZ3JhcGgiIGZvbnQtZmFtaWx5PSJNdXNlbyIgZm9udC1zaXplPSIzNTNweCIgZm9udC13ZWlnaHQ9IjMwMCI+PHRzcGFuIGNsYXNzPSJUZXh0UG9zaXRpb24iIHg9IjEzMDQiIHk9IjI0NTIiPjx0c3BhbiBmaWxsPSJyZ2IoMCwwLDApIiBzdHJva2U9Im5vbmUiPjEsMDAwLDAwMDwvdHNwYW4+PC90c3Bhbj48L3RzcGFuPjwvdGV4dD4KIDx0ZXh0IGNsYXNzPSJUZXh0U2hhcGUiPjx0c3BhbiBjbGFzcz0iVGV4dFBhcmFncmFwaCIgZm9udC1mYW1pbHk9Ik11c2VvIiBmb250LXNpemU9IjM1M3B4IiBmb250LXdlaWdodD0iMzAwIj48dHNwYW4gY2xhc3M9IlRleHRQb3NpdGlvbiIgeD0iMTMwNCIgeT0iMTQ3OCI+PHRzcGFuIGZpbGw9InJnYigwLDAsMCkiIHN0cm9rZT0ibm9uZSI+MSwyMDAsMDAwPC90c3Bhbj48L3RzcGFuPjwvdHNwYW4+PC90ZXh0PgogPHRleHQgY2xhc3M9IlRleHRTaGFwZSI+PHRzcGFuIGNsYXNzPSJUZXh0UGFyYWdyYXBoIiBmb250LWZhbWlseT0iTXVzZW8iIGZvbnQtc2l6ZT0iMzUzcHgiIGZvbnQtd2VpZ2h0PSIzMDAiPjx0c3BhbiBjbGFzcz0iVGV4dFBvc2l0aW9uIiB4PSIxMzA0IiB5PSI1MDQiPjx0c3BhbiBmaWxsPSJyZ2IoMCwwLDApIiBzdHJva2U9Im5vbmUiPjEsNDAwLDAwMDwvdHNwYW4+PC90c3Bhbj48L3RzcGFuPjwvdGV4dD4KIDxwYXRoIGZpbGw9InJnYigwLDY5LDEzNCkiIHN0cm9rZT0ibm9uZSIgZD0iTSAxMzgwOSw0MzUyIEwgMTM3MDMsNDM1MiAxMzcwMyw0MTQxIDEzOTE0LDQxNDEgMTM5MTQsNDM1MiAxMzgwOSw0MzUyIFoiLz4KIDxwYXRoIGZpbGw9InJnYigyNTUsNjYsMTQpIiBzdHJva2U9Im5vbmUiIGQ9Ik0gMTM4MDksNDg1NyBMIDEzNzAzLDQ4NTcgMTM3MDMsNDY0NiAxMzkxNCw0NjQ2IDEzOTE0LDQ4NTcgMTM4MDksNDg1NyBaIi8+CiA8dGV4dCBjbGFzcz0iVGV4dFNoYXBlIj48dHNwYW4gY2xhc3M9IlRleHRQYXJhZ3JhcGgiIGZvbnQtZmFtaWx5PSJNdXNlbyIgZm9udC1zaXplPSIzNTNweCIgZm9udC13ZWlnaHQ9IjMwMCI+PHRzcGFuIGNsYXNzPSJUZXh0UG9zaXRpb24iIHg9IjE0MDE0IiB5PSI0MzY4Ij48dHNwYW4gZmlsbD0icmdiKDAsMCwwKSIgc3Ryb2tlPSJub25lIj5sb2FkICsgdXNlPC90c3Bhbj48L3RzcGFuPjwvdHNwYW4+PC90ZXh0PgogPHRleHQgY2xhc3M9IlRleHRTaGFwZSI+PHRzcGFuIGNsYXNzPSJUZXh0UGFyYWdyYXBoIiBmb250LWZhbWlseT0iTXVzZW8iIGZvbnQtc2l6ZT0iMzUzcHgiIGZvbnQtd2VpZ2h0PSIzMDAiPjx0c3BhbiBjbGFzcz0iVGV4dFBvc2l0aW9uIiB4PSIxNDAxNCIgeT0iNDg3MyI+PHRzcGFuIGZpbGw9InJnYigwLDAsMCkiIHN0cm9rZT0ibm9uZSI+bmV3ICsgdXNlPC90c3Bhbj48L3RzcGFuPjwvdHNwYW4+PC90ZXh0PgogPHRleHQgY2xhc3M9IlRleHRTaGFwZSI+PHRzcGFuIGNsYXNzPSJUZXh0UGFyYWdyYXBoIiBmb250LWZhbWlseT0iTXVzZW8iIGZvbnQtc2l6ZT0iMzE4cHgiIGZvbnQtd2VpZ2h0PSIzMDAiPjx0c3BhbiBjbGFzcz0iVGV4dFBvc2l0aW9uIiB4PSI2MDY5IiB5PSI4NDA0Ij48dHNwYW4gZmlsbD0icmdiKDAsMCwwKSIgc3Ryb2tlPSJub25lIj5LaW5kIG9mIGdyYW1tYXI8L3RzcGFuPjwvdHNwYW4+PC90c3Bhbj48L3RleHQ+CiA8dGV4dCBjbGFzcz0iVGV4dFNoYXBlIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg4MDcsNDgyOSkgcm90YXRlKC05MCkgdHJhbnNsYXRlKC04MDcsLTQ4MjkpIj48dHNwYW4gY2xhc3M9IlRleHRQYXJhZ3JhcGgiIGZvbnQtZmFtaWx5PSJNdXNlbyIgZm9udC1zaXplPSIzMThweCIgZm9udC13ZWlnaHQ9IjMwMCI+PHRzcGFuIGNsYXNzPSJUZXh0UG9zaXRpb24iIHg9IjgwNyIgeT0iNDgyOSI+PHRzcGFuIGZpbGw9InJnYigwLDAsMCkiIHN0cm9rZT0ibm9uZSI+VGltZSBpbiBtczwvdHNwYW4+PC90c3Bhbj48L3RzcGFuPjwvdGV4dD4KPC9zdmc+"
        style="max-width: 600px; width: 100%" />
      <figcaption>
        This graph compares the two following scenarii: Load the in-memory
        parser from a grammar and then use it, against load the in-memor parser
        from a grammar, save it into a file, and then use it as a regular class
        with a <code>new</code> operator to instanciate the parser. It has been
        applied to three different grammars landing in Hoa:
        <a href="http://central.hoa-project.net/Resource/Library/Json"><code>Hoa\Json</code></a>,
        <a href="http://central.hoa-project.net/Resource/Library/Math"><code>Hoa\Math</code></a>
        and
        <a href="http://central.hoa-project.net/Resource/Library/Ruler"><code>Hoa\Ruler</code></a>.
        The “save” scenario is faster.
      </figcaption>
    </figure>

    <h2>Disabling Unicode support</h2>

    <p>
      Another pragma has been introduced to disable Unicode support in the
      lexer:
    </p>
    <pre><code>%pragma lexer.unicode false</code></pre>
    <p>
      This is particularly useful when the grammar defines a binary language or
      defines its own Unicode support. This is the case of
      <a href="http://central.hoa-project.net/Resource/Library/Json"><code>Hoa\Json</code></a>.
      The RFC7159 is under fully implementation and JSON uses the same UTF-8
      format than Javascript: With surrogate pairs. This was not possible to
      correctly lexically analyse a JSON string with PCRE Unicode support
      enabled. With this new pragma, this is possible.
    </p>
    <p>
      Also, the JSON grammar defines a LL(<em>0</em>) parser thanks to the
      <code>parser.lookahead</code> pragma.
    </p>

    <h2>Quality</h2>

    <p>
      Integration test suites were landing in the <code>Hoa\Compiler</code>
      library, but there was no unit test suites. This uncomfortable situation
      is now fixed. New integration test suites have been written too. Now we
      have:
    </p>
    <ul>
      <li>24 test suites,</li>
      <li>136 test cases,</li>
      <li><strong>320,242 assertions</strong>.</li>
    </ul>
    <p>
      Yes, this is not a mistake: 320,242 assertions. We obtain this number by
      using Grammar-based Testing algorithms, defined in the following research
      paper:
      <a href="http://hoa-project.net/En/Event/Amost12.html"><cite>Grammar-Based
      Testing using Realistic Domains in PHP</cite></a>. This paper has been
      written by the authors of the <code>Hoa\Compiler</code> library. You might
      enjoy reading this article.
    </p>
    <p>Finally, 2 bugs have been found and fixed.</p>

    <h2>Next optimisations</h2>

    <p>
      We still have ideas for new optimisations. <code>Hoa\Compiler</code> is
      more and more used (recent example is
      <a href="https://github.com/K-Phoen/rulerz">RulerZ</a>) and we are working
      hard to provide the best quality as much as possible.
    </p>
  </article>
</overlay>